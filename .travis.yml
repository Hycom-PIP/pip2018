language: java
sudo: false
install: true
jdk: oraclejdk8

jobs:
  include:
  - stage: Discovery Service
    env: MODULE_DIR=discovery-service
  - stage: Edge Service
    env: MODULE_DIR=edge-service
  - stage: Hello Service
    env: MODULE_DIR=hello-service

before_install:
 - cd $MODULE_DIR
 
addons:
  sonarcloud:
    organization: "hycom-pip"
    token:
      secure: "8c8cd60936858ad29039d8e29a8dad33bcc27b81"

script:
 - mvn test

 - mvn clean verify sonar:sonar

 # In some situation you may want to run sonar:sonar goal as a dedicated step. Be sure to use install as first step for multi-module projects
 - mvn clean install
 - mvn sonar:sonar -Dsonar.branch

 # Specify the version of sonar-maven-plugin instead of using the latest. See also 'How to Fix Version of Maven Plugin' below.
 - mvn org.sonarsource.scanner.maven:sonar-maven-plugin:3.4.0.905:sonar